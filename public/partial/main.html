<div class="wrapper">
    <div class="col-md-3">
        <div class="card">
<!--             <p id="name" class="card-text"></p> -->
<!--             <p class="card-text">Recent Number of Deliveries:  </p> -->
            <p class="card-heading">Recent Number of Deliveries</p>
            <p id="current" class="card-lg-text-normal"></p>
            <!-- <div class="counter-wrapper">
                <ul class="flip-counter default" id="myCounter"></ul>
            </div> -->
        </div>
        <div class="card visible-lg visible-md">
            <h3 class="card-heading"> Announcement </h3>
            <p class="announcement">Welcome to Pocketask Inc.</p>
        </div>
    </div>
    <div class="button-area col-md-6">
        <button class="button1" id="driver-button" data-toggle="modal" data-target="#confirm-modal">
<!--         <button class="button1" id="driver-button" onClick="requestDriver()"> -->
<!--             <p id="btn-description">Need a driver now</p> -->
        </button>
        <div class="modal fade bs-example-modal-sm" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true" id="confirm-modal" data-backdrop="static" data-keyboard="false">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-body">
                        <p>Are you sure?</p>   
                        <p id="timeLeft">The request will be proceed in: 10 seconds</p> 
                        <button type="button" class="btn btn-default" data-dismiss="modal" id="abort" onclick="abort()">Abort now</button>
                        <button type="button" class="btn btn-primary" data-dismiss="modal" onclick="proceed()">Yes, proceed</button>
                    </div>
                </div>
            </div>
        </div>
        <script>

        var cancel = false;
        var countdownNum = 10;
        $('#confirm-modal').on('show.bs.modal', function() {
            // setTimeout(function() {
            //     $('#confirm-modal').modal('hide');
            // }, 10000);
            // setTimeout(function(){
            //     document.getElementById('submitButton').disabled = null;
            //     },10000);
            // var countdownNum = 10;
            incTimer();
            document.getElementById('timeLeft').innerHTML = 'The request will be proceed in: 10 seconds';
            function incTimer(){
                cancel = false;
                setTimeout(function(){
                    if(countdownNum !== 0 && cancel === false) {
                        countdownNum--;
                        document.getElementById('timeLeft').innerHTML = 'The request will be proceed in: ' + countdownNum + ' seconds';
                        incTimer();
                    } else if(countdownNum === 0 && cancel === false) {
                        cancel = false;
                        countdownNum = 10;
                        $('#confirm-modal').modal('hide');
                        requestDriver();
                    }
                },1000);
            }
        });
        // $('#abort').onClick{
        //     var countdownNum = -1;
        //     var cancel = true;
        //     document.getElementById('timeLeft').innerHTML = 'The request will be proceed in: 10 seconds';
        // }
        function abort(){
            cancel = true;
            countdownNum = 10;
        }
        function proceed(){
            cancel = true;
            countdownNum = 10;
            requestDriver();
        }
        </script>


    </div>
    <div class="button-area col-md-3">
        <div class="card-long" ng-controller="histctrl">
<!--             <p class="card-text" style="margin-top: 0;">Last Ten Orders</p> -->
            <p class="card-heading-simple">Last Ten Orders</p>
            <table class="table table-striped">
                <thead>
                    <tr>
                        <td style="font-family: Impact; color: #777;">Date & Time</td>
                    </tr>
                </thead>
                <tbody id="history-table-body">
                    <tr ng-repeat="hist in hists"> 
                        <td>{{hist.date}}</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>
<script>
// document.getElementById('name').innerHTML = "Username: " + getCookie('name');
var restaurant = getRestaurant();
document.getElementById('current').innerHTML = restaurant.current_requests;
function histctrl($scope) {
    var keepgoing = 1;
    var hists = restaurant.request_history;
    $scope.hists = [];
    hists.reverse();
    angular.forEach(hists, function(value) {
        if (keepgoing <=10){
            value.date = new Date(value.date).toString().substring(0,25);
            $scope.hists.push(value);
            keepgoing += 1;
        }
    });
}
</script>