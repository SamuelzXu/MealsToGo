<script>
checktoken("uncompleted-wrapper");
</script>
<div class="wrapper" style="min-height: 595px;" id="uncompleted-wrapper">

    <div class="col-md-7" id="outer-box">
        <div class="pad">
            <div class="card-long" id="history-cardd" ng-controller="unctrl">
            	<table class="table table-striped table-hover">
            		<thead>
                		<tr>
                            <td>Action</td>
                            <td>Full-name</td>
                            <td>Date</td>
                		</tr>
            		</thead>
            		<tbody>
                        <tr ng-repeat="un in uns">
                            <td>
                                <button ng-click="assign(un._id)">
                                    Assign Driver
                                </button>
                            </td>
                            <td>{{un.requestedBy.fullname}}</td>
                            <td>{{un.requestedAt}}</td>
                        </tr>
                	</tbody>
                </table>
            </div>
        </div>
    </div>
    <div class="col-md-5 hidden-xs">
        <div class="pad">
            <div class="card">
                <p class="card-heading">Miscellaneous</p>
                <button id="main-clear" style="cursor: pointer;" data-toggle="modal" 
                    data-target="#confirm-modal">Clear All Counters</button>
            </div>
            <div class="card" ng-controller="datactrl">
                <p class="card-heading">Data</p>
                <p id="cur" class="card-content">Number of requests in current peroid:</p>
                <p id="total" class="card-content">Number of total requests:</p>
            </div>
        </div>
    </div>
    <div class="modal fade bs-example-modal-sm" tabindex="-1" role="dialog" 
        aria-labelledby="mySmallModalLabel" aria-hidden="true" id="confirm-modal" 
        data-backdrop="static" data-keyboard="false">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header" style="height: 60px;">
                    <button type="button" class="cclose" data-dismiss="modal" 
                        aria-hidden="true">&times;</button>
                </div>
                <div class="modal-body">
                    <p>Click "Yes" to continue clear all the counters.</p>
                    <p>Clear all restaurants' counters will generate their balance at the 
                    same time. </p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal" 
                        id="abort">No</button>
                    <button type="button" class="btn btn-primary" data-dismiss="modal" 
                        onclick="clearcounter()">Yes, Clear All Counters</button>
                </div>
            </div>
        </div>
    </div>  
</div>
<script>
function datactrl($scope, $http) {
    $scope.getcur = function(fun) {
        $http({method : 'GET', url : 'http://localhost:8080/requests/current', headers : {'token' : localStorage.getItem("token")}})
        .success(function(data) {
            document.getElementById("cur").innerHTML = "Current Requests: " + data['currentRequests']['currentRequests'];
        })
        .error(function(data) {
            alert(data + ' can not get current number of requests.');
        });
    };
    $scope.gettotal = function(fun) {
        $http({method : 'GET', url : 'http://localhost:8080/requests/total', headers : {'token' : localStorage.getItem("token")}})
        .success(function(data) {
            document.getElementById("total").innerHTML = "Current Requests: " + data['totalRequests'];
        })
        .error(function(data) {
            alert(data + ' can not get total number of requests.');
        });
    };
    $scope.getcur();
    $scope.gettotal();
}
function unctrl($scope, $http) {
    var uns = getUnassigned();
    $scope.uns = [];
    angular.forEach(uns, function(value) {
        value.requestedAt = new Date(value.requestedAt).toString().substring(0, 25);
        $scope.uns.push(value);
    });
    $scope.assign = function(id) {
        window.location=('/admin/assigndriver?id=' + id);
    }
}
</script>